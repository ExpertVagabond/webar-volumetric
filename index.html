<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Volumetric Video — Purple Squirrel Media</title>
  <meta name="description" content="Real-time chroma-key compositing showcase. Canvas-rendered content on green screen with GLSL shader removal. AI scene generation and AR camera mode.">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#8b5cf6">
  <meta property="og:title" content="Volumetric Video — Purple Squirrel Media">
  <meta property="og:description" content="Real-time chroma-key compositing with GLSL shader removal. AI scene generation and AR camera mode.">
  <meta property="og:image" content="/og-image.png">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@squirrel_eth">
  <meta name="twitter:title" content="Volumetric Video — Purple Squirrel Media">
  <meta name="twitter:description" content="Real-time chroma-key compositing with GLSL shaders and AI scene generation.">
  <meta name="twitter:image" content="/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#08080f; --surface:#111119; --purple:#8b5cf6; --purple-light:#c084fc; --cyan:#00b5ad; --green:#00edaf; --orange:#f2711c; --text:#eae6f2; --text-dim:#7b7390; }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden}
    body{font-family:'Outfit',sans-serif;background:transparent;color:var(--text)}

    /* ── Page entrance animation ── */
    @keyframes pageReveal{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .hud,.controls,.info-badge{animation:pageReveal 0.6s ease-out both}
    .hud{animation-delay:0.3s}
    .controls{animation-delay:0.5s}
    .info-badge{animation-delay:0.7s}

    #viewer{position:fixed;inset:0}

    /* ── HUD — Glassmorphism ── */
    .hud{position:fixed;top:0;left:0;right:0;z-index:10;padding:0.75rem 1rem;backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);background:rgba(8,8,15,.6);border-bottom:1px solid rgba(242,113,28,.08);box-shadow:0 4px 20px rgba(0,0,0,.3);display:flex;justify-content:space-between;align-items:center}
    .hud h1{font-size:1.1rem;font-weight:700;background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .hud-right{display:flex;align-items:center;gap:0.5rem}
    #demo-name{font-family:'JetBrains Mono',monospace;font-size:0.75rem;color:var(--cyan);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:rgba(0,181,173,.08);border:1px solid rgba(0,237,175,.12);border-radius:20px;padding:0.25rem 0.75rem;letter-spacing:0.02em}

    /* ── Controls bar — Premium glass ── */
    .controls{position:fixed;bottom:0;left:0;right:0;z-index:10;padding:1rem;backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);background:rgba(8,8,15,.7);border-top:1px solid rgba(255,255,255,.04);box-shadow:0 -4px 30px rgba(0,0,0,.4);display:flex;flex-direction:column;gap:0.75rem;align-items:center}
    .btn-row{display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center}
    .ctrl-btn{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:rgba(14,14,30,.6);border:1px solid rgba(255,255,255,0.08);color:var(--text);font-family:'Outfit',sans-serif;font-weight:600;font-size:0.85rem;padding:0.7rem 1.3rem;border-radius:12px;cursor:pointer;transition:all 0.25s cubic-bezier(.4,0,.2,1);box-shadow:0 2px 8px rgba(0,0,0,.2)}
    .ctrl-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.3);background:rgba(14,14,30,.8);border-color:rgba(255,255,255,.12)}
    .ctrl-btn:active{transform:scale(0.95) translateY(0);background:var(--purple);box-shadow:0 2px 12px rgba(139,92,246,.3)}
    .ctrl-btn.active{border-color:var(--green);color:var(--green);box-shadow:0 0 12px rgba(0,237,175,.15);animation:activeGlow 2s ease-in-out infinite}
    @keyframes activeGlow{0%,100%{box-shadow:0 0 12px rgba(0,237,175,.15);border-color:var(--green)}50%{box-shadow:0 0 20px rgba(0,237,175,.3),0 0 40px rgba(0,237,175,.08);border-color:rgba(0,237,175,.8)}}

    /* ── Sliders — Custom styled range ── */
    .sliders{display:flex;gap:1rem;width:100%;max-width:400px}
    .slider-group{flex:1;display:flex;flex-direction:column;gap:0.35rem}
    .slider-group label{font-size:0.7rem;color:var(--text-dim);font-family:'JetBrains Mono',monospace;letter-spacing:0.04em;opacity:0.85}
    .slider-group input[type=range]{width:100%;height:4px;-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer}
    .slider-group input[type=range]::-webkit-slider-runnable-track{height:4px;border-radius:2px;background:linear-gradient(90deg,var(--purple),var(--purple-light))}
    .slider-group input[type=range]::-moz-range-track{height:4px;border-radius:2px;background:linear-gradient(90deg,var(--purple),var(--purple-light));border:none}
    .slider-group input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--green);margin-top:-6px;border:2px solid rgba(8,8,15,.5);box-shadow:0 0 8px rgba(0,237,175,.4),0 0 16px rgba(0,237,175,.15);transition:box-shadow 0.2s}
    .slider-group input[type=range]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:var(--green);border:2px solid rgba(8,8,15,.5);box-shadow:0 0 8px rgba(0,237,175,.4),0 0 16px rgba(0,237,175,.15);transition:box-shadow 0.2s}
    .slider-group input[type=range]:hover::-webkit-slider-thumb{box-shadow:0 0 12px rgba(0,237,175,.6),0 0 24px rgba(0,237,175,.25)}
    .slider-group input[type=range]:hover::-moz-range-thumb{box-shadow:0 0 12px rgba(0,237,175,.6),0 0 24px rgba(0,237,175,.25)}

    /* ── AI Prompt input — Glass + purple focus ── */
    /* (targets the inline-styled input via ID) */
    #ai-prompt{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:rgba(14,14,30,.5) !important;border:1px solid rgba(139,92,246,.12) !important;padding:0.55rem 0.85rem !important;border-radius:10px !important;transition:all 0.25s ease !important}
    #ai-prompt:focus{border-color:rgba(139,92,246,.5) !important;box-shadow:0 0 0 3px rgba(139,92,246,.15),0 0 20px rgba(139,92,246,.1) !important;background:rgba(14,14,30,.7) !important}
    #ai-prompt::placeholder{color:var(--text-dim);opacity:0.6}

    /* ── Info Badge — Glass pill ── */
    .info-badge{position:fixed;bottom:150px;left:50%;transform:translateX(-50%);font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--text-dim);z-index:10;text-align:center;pointer-events:none;max-width:350px;line-height:1.6;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);background:rgba(14,14,30,.7);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:0.6rem 1rem;box-shadow:0 4px 16px rgba(0,0,0,.25)}
    @media (max-width:500px){.info-badge{display:none}.btn-row{gap:0.3rem}.ctrl-btn{font-size:0.75rem;padding:0.5rem 0.8rem}}

    /* ── PSM Cross-Product Footer ── */
    .psm-footer{position:fixed;bottom:0;left:0;right:0;z-index:30;pointer-events:none;opacity:0;transition:opacity 0.4s}
    .psm-footer.show{opacity:1;pointer-events:auto}
    .psm-footer-inner{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0.75rem;background:rgba(8,8,15,0.92);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1px solid rgba(139,92,246,0.1);overflow-x:auto;box-shadow:0 -2px 16px rgba(0,0,0,.3)}
    .psm-footer-brand{display:flex;align-items:center;gap:0.4rem;flex-shrink:0;text-decoration:none;color:var(--text);font-weight:700;font-size:0.7rem;padding-right:0.5rem;border-right:1px solid rgba(255,255,255,0.06)}
    .psm-footer-brand img{width:20px;height:20px;border-radius:50%}
    .psm-footer-links{display:flex;gap:0.3rem;flex:1;overflow-x:auto;scrollbar-width:none}
    .psm-footer-links::-webkit-scrollbar{display:none}
    .psm-footer-link{flex-shrink:0;font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--text-dim);text-decoration:none;padding:0.25rem 0.5rem;border-radius:6px;border:1px solid rgba(255,255,255,0.04);transition:all 0.2s;white-space:nowrap}
    .psm-footer-link:hover{color:var(--text);border-color:rgba(139,92,246,0.2);background:rgba(139,92,246,0.06)}
    .psm-footer-link.current{color:#8b5cf6;border-color:rgba(139,92,246,0.3);background:rgba(139,92,246,0.08)}

    /* ── Loading splash — Ambient glow ── */
    /* ── Shader background canvas ── */
    #shader-bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;display:block}

    .splash{position:fixed;inset:0;z-index:9999;background:radial-gradient(ellipse 60% 50% at 50% 45%,rgba(242,113,28,.06),transparent 70%),radial-gradient(ellipse 50% 40% at 50% 50%,rgba(139,92,246,.05),transparent 65%),linear-gradient(180deg,rgba(6,6,12,.5) 0%,rgba(8,8,15,.5) 40%,rgba(10,8,18,.5) 100%);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;transition:opacity .5s,visibility .5s}
    .splash.done{opacity:0;visibility:hidden;pointer-events:none}
    .splash-logo{width:56px;height:56px;border-radius:50%;animation:splashPulse 1.2s ease-in-out infinite;box-shadow:0 0 30px rgba(242,113,28,.25),0 0 60px rgba(139,92,246,.15),0 0 90px rgba(242,113,28,.08)}
    .splash-bar{width:120px;height:3px;border-radius:2px;background:rgba(255,255,255,.05);overflow:hidden;margin-top:4px}
    .splash-bar-fill{height:100%;width:0;border-radius:2px;background:linear-gradient(90deg,var(--orange),var(--purple),var(--cyan));animation:splashLoad .8s ease-out forwards}
    @keyframes splashPulse{0%,100%{transform:scale(1);opacity:1;box-shadow:0 0 30px rgba(242,113,28,.25),0 0 60px rgba(139,92,246,.15)}50%{transform:scale(1.08);opacity:.7;box-shadow:0 0 45px rgba(242,113,28,.35),0 0 80px rgba(139,92,246,.25)}}
    @keyframes splashLoad{to{width:100%}}
  </style>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"SoftwareApplication","name":"Volumetric Video","description":"Real-time chroma-key compositing with GLSL shader removal. AI scene generation and AR camera mode.","applicationCategory":"WebApplication","operatingSystem":"Web Browser","author":{"@type":"Organization","name":"Purple Squirrel Media","url":"https://purplesquirrelmedia.io"},"offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>
</head>
<body>

  <canvas id="shader-bg"></canvas>

  <div class="splash" id="splash">
    <img src="/logo-nav.jpg" alt="PSM" class="splash-logo">
    <div class="splash-bar"><div class="splash-bar-fill"></div></div>
  </div>
  <div id="viewer"></div>

  <div class="hud">
    <div style="display:flex;align-items:center;gap:0.5rem">
      <img src="/logo-nav.jpg" alt="PSM" style="width:28px;height:28px;border-radius:50%">
      <div>
        <h1>Volumetric Video</h1>
        <small style="font-family:'JetBrains Mono',monospace;color:var(--text-dim);font-size:0.65rem">ChromaKey GLSL Shader</small>
      </div>
    </div>
    <div class="hud-right">
      <span id="demo-name">Dancing Robot</span>
    </div>
  </div>

  <div class="info-badge">
    Canvas renders animated content on green background (left preview).<br>
    ChromaKey GLSL shader removes green in real-time (center billboard).
  </div>

  <div class="controls">
    <div class="btn-row">
      <button class="ctrl-btn active" id="toggle-chroma">ChromaKey: ON</button>
      <button class="ctrl-btn" id="next-demo">Next Demo &rarr;</button>
      <button class="ctrl-btn" id="ai-generate">&#129302; AI Generate</button>
      <button class="ctrl-btn" id="ar-camera" data-active="false">&#128247; AR Mode</button>
    </div>
    <div style="width:100%;max-width:400px;display:flex;gap:0.5rem;align-items:center">
      <label style="font-size:0.6rem;color:var(--text-dim);font-family:'JetBrains Mono',monospace;white-space:nowrap">AI Prompt</label>
      <input type="text" id="ai-prompt" placeholder="holographic dancer on stage" style="flex:1;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.4rem 0.6rem;border-radius:8px;outline:none">
    </div>
    <div class="sliders">
      <div class="slider-group">
        <label>Similarity</label>
        <input type="range" id="similarity" min="0" max="0.8" step="0.01" value="0.3">
      </div>
      <div class="slider-group">
        <label>Smoothness</label>
        <input type="range" id="smoothness" min="0.01" max="0.5" step="0.01" value="0.1">
      </div>
    </div>
  </div>

  <div class="psm-footer show">
    <div class="psm-footer-inner">
      <a href="https://purplesquirrelmedia.io" target="_blank" class="psm-footer-brand"><img src="/logo-nav.jpg" alt="PSM">PSM</a>
      <div class="psm-footer-links">
        <a href="https://psm-webar-portfolio.pages.dev" class="psm-footer-link">Portfolio</a>
        <a href="https://webar-face-filters.pages.dev" class="psm-footer-link">Face Filters</a>
        <a href="https://webar-ecommerce.pages.dev" class="psm-footer-link">AR Shop</a>
        <a href="https://webar-volumetric.pages.dev" class="psm-footer-link current">Volumetric</a>
        <a href="https://webar-scavenger-hunt.pages.dev" class="psm-footer-link">Scavenger Hunt</a>
        <a href="https://webar-game-kit.pages.dev" class="psm-footer-link">Mini Golf</a>
        <a href="https://8thwall-archive.pages.dev" class="psm-footer-link">8th Wall</a>
      </div>
    </div>
  </div>

  <script type="module" src="/src/app.js"></script>
  <script>
  window.addEventListener('load',()=>setTimeout(()=>document.getElementById('splash').classList.add('done'),800));
  document.querySelectorAll('.psm-footer-link').forEach(l=>{l.addEventListener('mouseenter',()=>{if(l.classList.contains('current'))return;const p=document.createElement('link');p.rel='prefetch';p.href=l.href;if(!document.querySelector('link[href="'+l.href+'"]'))document.head.appendChild(p)},{once:true})});
  </script>

  <!-- Volumetric fog / ray-marching shader background -->
  <script>
  (function() {
    var canvas = document.getElementById('shader-bg');
    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (!gl) return;

    var dpr = (window.devicePixelRatio || 1) * 0.5;

    function resize() {
      canvas.width  = window.innerWidth  * dpr;
      canvas.height = window.innerHeight * dpr;
      gl.viewport(0, 0, canvas.width, canvas.height);
    }
    resize();
    window.addEventListener('resize', resize);

    /* Vertex shader — fullscreen quad */
    var vsSource = [
      'attribute vec2 a_pos;',
      'void main(){gl_Position=vec4(a_pos,0.0,1.0);}'
    ].join('\n');

    /* Fragment shader — volumetric fog via simplified ray marching + fBm */
    var fsSource = [
      'precision mediump float;',
      'uniform float u_time;',
      'uniform vec2 u_resolution;',
      '',
      '/* Hash-based pseudo-random — fast, no textures */',
      'float hash(vec3 p){',
      '  p=fract(p*0.3183099+.1);',
      '  p*=17.0;',
      '  return fract(p.x*p.y*p.z*(p.x+p.y+p.z));',
      '}',
      '',
      '/* Value noise with smooth interpolation */',
      'float noise(vec3 p){',
      '  vec3 i=floor(p);',
      '  vec3 f=fract(p);',
      '  f=f*f*(3.0-2.0*f);',
      '  return mix(mix(mix(hash(i+vec3(0,0,0)),hash(i+vec3(1,0,0)),f.x),',
      '                 mix(hash(i+vec3(0,1,0)),hash(i+vec3(1,1,0)),f.x),f.y),',
      '             mix(mix(hash(i+vec3(0,0,1)),hash(i+vec3(1,0,1)),f.x),',
      '                 mix(hash(i+vec3(0,1,1)),hash(i+vec3(1,1,1)),f.x),f.y),f.z);',
      '}',
      '',
      '/* Fractional Brownian Motion — 5 octaves for rich detail */',
      'float fbm(vec3 p){',
      '  float v=0.0;float a=0.5;',
      '  vec3 shift=vec3(100.0);',
      '  for(int i=0;i<5;i++){',
      '    v+=a*noise(p);',
      '    p=p*2.0+shift;',
      '    a*=0.5;',
      '  }',
      '  return v;',
      '}',
      '',
      '/* Volumetric density field — swirling nebula */',
      'float map(vec3 p){',
      '  float t=u_time*0.08;',
      '  /* Domain warping: distort coords with fbm for organic swirl */',
      '  vec3 q=vec3(',
      '    fbm(p+vec3(0.0,0.0,t)),',
      '    fbm(p+vec3(5.2,1.3,t*0.7)),',
      '    fbm(p+vec3(2.1,3.7,t*0.5))',
      '  );',
      '  vec3 r=vec3(',
      '    fbm(p+4.0*q+vec3(1.7,9.2,t*0.4)),',
      '    fbm(p+4.0*q+vec3(8.3,2.8,t*0.6)),',
      '    0.0',
      '  );',
      '  return fbm(p+4.0*r);',
      '}',
      '',
      'void main(){',
      '  vec2 uv=(gl_FragCoord.xy-0.5*u_resolution)/min(u_resolution.x,u_resolution.y);',
      '',
      '  /* Camera setup — looking into the fog */',
      '  vec3 ro=vec3(0.0,0.0,-1.0);  /* ray origin */',
      '  vec3 rd=normalize(vec3(uv,1.0));  /* ray direction */',
      '',
      '  /* Ray march through volumetric fog */',
      '  float density=0.0;',
      '  vec3 col=vec3(0.0);',
      '  float t=0.0;',
      '  float dt=0.15;  /* step size — larger = faster, less detail */',
      '',
      '  for(int i=0;i<32;i++){',
      '    vec3 p=ro+rd*t;',
      '    /* Slow swirl around z axis */',
      '    float angle=u_time*0.03;',
      '    float cs=cos(angle);float sn=sin(angle);',
      '    p.xy=mat2(cs,-sn,sn,cs)*p.xy;',
      '',
      '    float d=map(p*0.6);',
      '    d=smoothstep(0.3,0.9,d);',
      '',
      '    /* Color: orange core, purple edges, dark base */',
      '    vec3 localCol=mix(',
      '      vec3(0.12,0.03,0.08),  /* deep purple-black */',
      '      mix(',
      '        vec3(0.55,0.15,0.45),  /* rich purple */',
      '        vec3(0.9,0.45,0.1),    /* warm orange */',
      '        d*d',
      '      ),',
      '      d',
      '    );',
      '',
      '    /* Accumulate density and color — front-to-back compositing */',
      '    float alpha=d*0.06;',
      '    col+=localCol*alpha*(1.0-density);',
      '    density+=alpha*(1.0-density);',
      '',
      '    if(density>0.95)break;',
      '    t+=dt;',
      '  }',
      '',
      '  /* Subtle vignette to darken edges */',
      '  float vig=1.0-0.5*dot(uv,uv);',
      '  col*=vig;',
      '',
      '  /* Keep it subtle — scale overall brightness */',
      '  col*=1.8;',
      '',
      '  gl_FragColor=vec4(col,1.0);',
      '}'
    ].join('\n');

    function compile(type, source) {
      var s = gl.createShader(type);
      gl.shaderSource(s, source);
      gl.compileShader(s);
      if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
        console.error('Shader compile error:', gl.getShaderInfoLog(s));
        gl.deleteShader(s);
        return null;
      }
      return s;
    }

    var vs = compile(gl.VERTEX_SHADER, vsSource);
    var fs = compile(gl.FRAGMENT_SHADER, fsSource);
    if (!vs || !fs) return;

    var prog = gl.createProgram();
    gl.attachShader(prog, vs);
    gl.attachShader(prog, fs);
    gl.linkProgram(prog);
    if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {
      console.error('Shader link error:', gl.getProgramInfoLog(prog));
      return;
    }
    gl.useProgram(prog);

    /* Fullscreen quad: two triangles covering clip space */
    var buf = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buf);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]), gl.STATIC_DRAW);

    var aPos = gl.getAttribLocation(prog, 'a_pos');
    gl.enableVertexAttribArray(aPos);
    gl.vertexAttribPointer(aPos, 2, gl.FLOAT, false, 0, 0);

    var uTime = gl.getUniformLocation(prog, 'u_time');
    var uRes  = gl.getUniformLocation(prog, 'u_resolution');

    var start = performance.now();

    function frame() {
      var t = (performance.now() - start) * 0.001;
      gl.uniform1f(uTime, t);
      gl.uniform2f(uRes, canvas.width, canvas.height);
      gl.drawArrays(gl.TRIANGLES, 0, 6);
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  })();
  </script>
</body>
</html>
